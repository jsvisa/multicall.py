from multicall.eth_decode import eth_decode_input
from tests.testdata import ABI_swapETHForSpecificNFTs, ABI_matchAdvancedOrders


class TestEthDecode:
    def test_eth_decode_input(self):
        abi = ABI_swapETHForSpecificNFTs

        data = "0x111320000000000000000000000000000000000000000000000000000000000000000080000000000000000000000000ca6f3defbc6041299837725f6430f33b0f24e5c0000000000000000000000000ca6f3defbc6041299837725f6430f33b0f24e5c00000000000000000000000000000000000000000000000000000000062e9ca1800000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000575570f62c90a61763b1e93cf0da62ed810dbda2000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000561"  # noqa
        func_text, parameter = eth_decode_input(abi, data)
        WANT = "swapETHForSpecificNFTs((address,uint256[])[],address,address,uint256)"  # noqa
        assert func_text == WANT
        assert parameter == {
            "swapList": [
                {
                    "pair": "0x575570f62c90a61763b1e93cf0da62ed810dbda2",
                    "nftIds": (1377,),
                }
            ],
            "ethRecipient": "0xca6f3defbc6041299837725f6430f33b0f24e5c0",
            "nftRecipient": "0xca6f3defbc6041299837725f6430f33b0f24e5c0",
            "deadline": 1659488792,
        }

    def test_eth_decode_opensea_abi(self):
        abi = ABI_matchAdvancedOrders
        data = "0xf2d12b1200000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000ae00000000000000000000000000000000000000000000000000000000000000be00000000000000000000000001f818fef67fd1de70ed02f434f83455e3c754ecb0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000005a000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000046000000000000000000000000000000000000000000000000000000000000004c00000000000000000000000004a7eaaab1cb4c26e385b8f033d79a065f9dabc06000000000000000000000000000000e7ec00e7b300774b00001314b8610022b80000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000064f88f2c000000000000000000000000000000000000000000000000000000006501c9950000000000000000000000000000000000000000000000000000000000000000360c6ebe000000000000000000000000000000000000000006c1d8bcf411f5d70000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f0000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006a94d74f430000000000000000000000000000000000000000000000000000006a94d74f43000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004000000000000000000000000cd041f40d497038e2da65988b7d7e2c0d92446190000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000004a7eaaab1cb4c26e385b8f033d79a065f9dabc060000000000000000000000000000000000000000000000000000000000000001000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002aa1efb94e0000000000000000000000000000000000000000000000000000002aa1efb94e0000000000000000000000000000000a26b00c1f0df003000390027140000faa71900000000000000000000000000000000000000000000000000000000000000409f136c3cafe574732c29b22078569d9d0e4dfaccc8b4d8f1eea3a73cac6df2d9f38231cac8de48753e773ed952bd4b3c83b07dd6feab5f4e495920d3e1a5d010000000000000000000000000000000000000000000000000000000000000007e001f818fef67fd1de70ed02f434f83455e3c754ecb0000000064f980e16c4bbfd25c368a5609b719a26116dd854d7bf7c2f49333627645ecbf2cc03ca0c062bd40fde389b5a2e736a33de610ce5e8ee862fd6dde453e9fbc368336ec620000000000000000000000000000000000000000000000000000000000000005a4000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000046000000000000000000000000000000000000000000000000000000000000004800000000000000000000000001f818fef67fd1de70ed02f434f83455e3c754ecb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000064f88f2c000000000000000000000000000000000000000000000000000000006501c9950000000000000000000000000000000000000000000000000000000000000000360c6ebe0000000000000000000000000000000000000000499debe13b4f982e0000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f0000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000cd041f40d497038e2da65988b7d7e2c0d924461900000000000000000000000000000000000000000000000000000000000005a40000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044364c5bb000000000000000000000000000000000000000000000000000000044364c5bb0000000000000000000000000000dc4bca7958000ef99e8c3dc5a63707d3c2a1c39e0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000063a7538df320000000000000000000000000000000000000000000000000000063a7538df320000000000000000000000000001f818fef67fd1de70ed02f434f83455e3c754ecb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005a400000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000002800000000000000000000000000000000000000000000000000000000000000380000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000360c6ebe"  # noqa

        func_text, parameter = eth_decode_input(abi, data)
        WANT = "matchAdvancedOrders(((address,address,(uint8,address,uint256,uint256,uint256)[],(uint8,address,uint256,uint256,uint256,address)[],uint8,uint256,uint256,bytes32,uint256,bytes32,uint256),uint120,uint120,bytes,bytes)[],(uint256,uint8,uint256,uint256,bytes32[])[],((uint256,uint256)[],(uint256,uint256)[])[],address)"  # noqa

        assert func_text == WANT
        assert parameter == {
            "orders": [
                {
                    "parameters": {
                        "offerer": "0x4a7eaaab1cb4c26e385b8f033d79a065f9dabc06",
                        "zone": "0x000000e7ec00e7b300774b00001314b8610022b8",
                        "offer": [
                            {
                                "itemType": 1,
                                "token": "0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2",
                                "identifierOrCriteria": 0,
                                "startAmount": 30000000000000000,
                                "endAmount": 30000000000000000,
                            }
                        ],
                        "consideration": [
                            {
                                "itemType": 4,
                                "token": "0xcd041f40d497038e2da65988b7d7e2c0d9244619",
                                "identifierOrCriteria": 0,
                                "startAmount": 1,
                                "endAmount": 1,
                                "recipient": "0x4a7eaaab1cb4c26e385b8f033d79a065f9dabc06",
                            },
                            {
                                "itemType": 1,
                                "token": "0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2",
                                "identifierOrCriteria": 0,
                                "startAmount": 750000000000000,
                                "endAmount": 750000000000000,
                                "recipient": "0x0000a26b00c1f0df003000390027140000faa719",
                            },
                        ],
                        "orderType": 2,
                        "startTime": 1694011180,
                        "endTime": 1694615957,
                        "zoneHash": "0000000000000000000000000000000000000000000000000000000000000000",
                        "salt": 24446860302761739304752683030156737591518664810215442929800869596976045487575,
                        "conduitKey": "0000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f0000",
                        "totalOriginalConsiderationItems": 2,
                    },
                    "numerator": 1,
                    "denominator": 1,
                    "signature": "9f136c3cafe574732c29b22078569d9d0e4dfaccc8b4d8f1eea3a73cac6df2d9f38231cac8de48753e773ed952bd4b3c83b07dd6feab5f4e495920d3e1a5d010",
                    "extraData": "001f818fef67fd1de70ed02f434f83455e3c754ecb0000000064f980e16c4bbfd25c368a5609b719a26116dd854d7bf7c2f49333627645ecbf2cc03ca0c062bd40fde389b5a2e736a33de610ce5e8ee862fd6dde453e9fbc368336ec620000000000000000000000000000000000000000000000000000000000000005a4",
                },
                {
                    "parameters": {
                        "offerer": "0x1f818fef67fd1de70ed02f434f83455e3c754ecb",
                        "zone": "0x0000000000000000000000000000000000000000",
                        "offer": [
                            {
                                "itemType": 2,
                                "token": "0xcd041f40d497038e2da65988b7d7e2c0d9244619",
                                "identifierOrCriteria": 1444,
                                "startAmount": 1,
                                "endAmount": 1,
                            }
                        ],
                        "consideration": [
                            {
                                "itemType": 1,
                                "token": "0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2",
                                "identifierOrCriteria": 0,
                                "startAmount": 1200000000000000,
                                "endAmount": 1200000000000000,
                                "recipient": "0xdc4bca7958000ef99e8c3dc5a63707d3c2a1c39e",
                            },
                            {
                                "itemType": 1,
                                "token": "0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2",
                                "identifierOrCriteria": 0,
                                "startAmount": 28050000000000000,
                                "endAmount": 28050000000000000,
                                "recipient": "0x1f818fef67fd1de70ed02f434f83455e3c754ecb",
                            },
                        ],
                        "orderType": 0,
                        "startTime": 1694011180,
                        "endTime": 1694615957,
                        "zoneHash": "0000000000000000000000000000000000000000000000000000000000000000",
                        "salt": 24446860302761739304752683030156737591518664810215442929805687343723960047662,
                        "conduitKey": "0000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f0000",
                        "totalOriginalConsiderationItems": 2,
                    },
                    "numerator": 1,
                    "denominator": 1,
                    "signature": "",
                    "extraData": "",
                },
            ],
            "criteriaResolvers": [
                {
                    "orderIndex": 0,
                    "side": 1,
                    "index": 0,
                    "identifier": 1444,
                    "criteriaProof": [],
                }
            ],
            "fulfillments": [
                {
                    "offerComponents": [{"orderIndex": 1, "itemIndex": 0}],
                    "considerationComponents": [{"orderIndex": 0, "itemIndex": 0}],
                },
                {
                    "offerComponents": [{"orderIndex": 0, "itemIndex": 0}],
                    "considerationComponents": [{"orderIndex": 0, "itemIndex": 1}],
                },
                {
                    "offerComponents": [{"orderIndex": 0, "itemIndex": 0}],
                    "considerationComponents": [{"orderIndex": 1, "itemIndex": 0}],
                },
                {
                    "offerComponents": [{"orderIndex": 0, "itemIndex": 0}],
                    "considerationComponents": [{"orderIndex": 1, "itemIndex": 1}],
                },
            ],
            "recipient": "0x1f818fef67fd1de70ed02f434f83455e3c754ecb",
        }
